# A.R.G.U.S.-v3 - Active Routing & Guarding Utility Service

A.R.G.U.S. は、ローカルで動作する高機能なフィルタリング・プロキシシステムです。指定したドメインへのアクセスをリアルタイムでブロックし、すべての通信ログを記録・管理するためのWebダッシュボードを提供します。

---

## 主な機能

-   **Web管理ダッシュボード**: 直感的なUIですべての通信ログを閲覧、検索、管理できます。
-   **ドメインベースのアクセスブロック**: `config/blocked_domains.txt` にドメインをリストアップするだけで、HTTP/HTTPSアクセスをリアルタイムに遮断します。
-   **カスタマイズ可能なブロックページ**: `templates/blocked_page.html` を編集して、ユーザーに表示されるブロックページを自由にデザインできます。
-   **リアルタイム監視コンソール**: `mitmweb`の強力なインターフェースで、すべての通信フローを詳細に確認できます。
-   **安定した実行環境**: Pythonの仮想環境（venv）を利用するため、PC環境に影響を与えず、ライブラリの依存関係問題を完全に解決します。

---

## クイックアクセス

A.R.G.U.S.の起動後、以下のURLにアクセスしてください。

| 目的                  | URL                               |
| --------------------- | --------------------------------- |
| **Web管理ダッシュボード** | `http://127.0.0.1:5000`           |
| **リアルタイム監視コンソール** | `http://127.0.0.1:8081`           |
| **証明書ダウンロードページ** | `http://mitm.it`                  |

---

## ファイル構成

````
C:/dev/A.R.G.U.S.-v3/
│
├── config/
│   ├── blocked_domains.txt  # ブロック対象ドメインのリスト
│   └── state.json           # フィルタリング有効/無効状態の保存
│
├── templates/
│   ├── index.html           # Web管理ダッシュボードのUI
│   └── blocked_page.html    # カスタムブロックページのUI
│
├── static/
│   └── js/
│       └── app.js           # ダッシュボードの動作を制御するJavaScript
│
├── venv/                    # Python仮想環境 (自動生成)
│
├── final-start.bat          # 起動用バッチファイル
├── main.py                  # Webサーバー (Flask) のエントリーポイント
├── proxy_addon.py           # プロキシ本体 (mitmproxy) のアドオン
├── README.md                # ★このファイル
└── argus.db                 # 通信ログが保存されるデータベース
````
---

## 必須要件

-   **OS**: Windows 10 / 11
-   **Python**: Version 3.8 以上
    -   インストール時に **「Add Python to PATH」** オプションを必ず有効にしてください。

---

## インストールとセットアップ

コマンドプロンプト（`cmd.exe`）を使い、一つずつコマンドを実行していきます。

### ステップ 1: プロジェクトフォルダへ移動

```cmd
cd /d "C:\dev\A.R.G.U.S.-v3"
```

### ステップ 2: Python仮想環境の作成

```cmd
python -m venv venv
```
*この操作は、PCごとに最初の1回だけでOKです。*

### ステップ 3: 仮想環境の有効化 (Activate)

```cmd
venv\Scripts\activate
```
*成功すると、プロンプトの先頭に `(venv)` と表示されます。*

### ステップ 4: 必要なライブラリのインストール

```cmd
pip install mitmproxy
pip install flask
pip install sqlalchemy
pip install flask-socketio 
```
*このコマンドで、A.R.G.U.S.に必要なライブラリがすべてインストールされます。*

---

## 使い方

### 1. A.R.G.U.S. の起動

`(venv)`(仮想環境)が起動していることを確認し
````cmd
.\final-start.bat
````
を実行 

### 2. プロキシの設定

監視したいデバイスやブラウザのプロキシ設定を以下のように構成します。

-   **プロキシサーバーのアドレス**: (A.R.G.U.S.を起動したPCのIPアドレス)
-   **ポート**: `8080`

*PC自身の通信を監視する場合は、アドレスに `127.0.0.1` を指定してください。*

### 3. HTTPS通信のための証明書インストール (重要)

HTTPSサイトを正しくブロック・監視するには、`mitmproxy`の証明書をデバイスに信頼させる必要があります。**この作業はデバイスごとに最初の1回だけ必要です。**

1.  A.R.G.U.S.を起動し、プロキシ設定を有効にした状態で、デバイスのブラウザで `http://mitm.it` にアクセスします。
2.  お使いのOSのアイコン（Windows, Apple, Androidなど）をクリックし、証明書ファイルをダウンロードしてインストールします。
    -   **Windows**: ダウンロードしたファイルをダブルクリックし、「証明書のインストール」→「現在のユーザー」→「証明書をすべて次のストアに配置する」→「参照」と進み、**「信頼されたルート証明機関」**を選択して完了します。
    -   **iOS/Android**: 画面の指示に従い、プロファイルをダウンロードしてインストール・信頼設定を行ってください。

### 4. ブロックリストの編集

ブロックしたいドメインを `config/blocked_domains.txt` ファイルに一行ずつ追記します。ファイルの変更はA.R.G.U.S.を再起動することなく即座に反映されます。

### 5. A.R.G.U.S. の終了

起動時に開いた2つのコマンドプロンプトウィンドウを、それぞれ右上の「×」ボタンで閉じるか、`Ctrl + C` を押してプロセスを終了してください。

---

## トラブルシューティング

-   **`mitm.it` にアクセスできない**:
    -   `final-start.bat` でA.R.G.U.S.が正しく起動しているか確認してください。
    -   デバイスのプロキシ設定が、PCのIPアドレスとポート`8080`に正しく設定されているか確認してください。

-   **証明書をインストールしてもHTTPSサイトで警告が出る**:
    -   証明書を**「信頼されたルート証明機関」**に正しくインストールしたか確認してください。
    -   一部のアプリケーションやブラウザ（Firefoxなど）は独自の証明書ストアを持つ場合があります。その場合は、各アプリケーションごとの手順に従って証明書をインポートする必要があります。
    -   一度ブラウザやアプリを完全に再起動してみてください。

-   **コマンド`python`や`pip`が見つからないと言われる**:
    -   Pythonのインストール時に「Add Python to PATH」オプションを有効にしなかった可能性があります。Pythonを再インストールするか、環境変数を手動で設定してください。
    -   手動でコマンドを実行する際は、仮想環境を有効化 (`venv\Scripts\activate`) し忘れていないか確認してください。

---

## ライセンス (License)

このプロジェクトは **MITライセンス** の下で公開されています。
