# A.R.G.U.S.-v3 - Active Routing & Guarding Utility Service

A.R.G.U.S. は、ローカルで動作する高機能なフィルタリング・プロキシシステムです。指定したドメインへのアクセスをブロックし、すべての通信ログを記録・管理するためのWebダッシュボードを提供します。

---

## 主な機能

-   **ドメインベースのアクセスブロック**: `config/blocked_domains.txt` にドメインをリストアップするだけで、リアルタイムにHTTP/HTTPSアクセスをブロックします。
-   **カスタマイズ可能なブロックページ**: ユーザーがアクセスをブロックされた際に表示されるページを、`templates/blocked_page.html`で自由にデザインできます。
-   **Web管理ダッシュボード**: すべての通信ログ（許可/ブロック）を閲覧、検索、クリアできます。
-   **リアルタイム監視コンソール**: すべての通信フローをリアルタイムで詳細に確認できる`mitmweb`のインターフェースを提供します。
-   **安定した実行環境**: Pythonの仮想環境（venv）を利用することで、PC環境に影響を与えず、ライブラリの依存関係問題を完全に解決します。

---

## クイックアクセス

A.R.G.U.S.の起動後、以下のURLにアクセスしてください。

-   **Web管理ダッシュボード**: `http://127.0.0.1:5000`
-   **リアルタイム監視コンソール**: `http://127.0.0.1:8081`
-   **証明書ダウンロードページ**: `http://mitm.it`

---

## 必須要件

-   **OS**: Windows 10 / 11
-   **Python**: Version 3.8 以上
    -   インストール時に**「Add Python to PATH」**または**「Install launcher for all users」**のオプションを有効にしてください。

---

## インストールとセットアップ (手動)

コマンドプロンプト（`cmd.exe`）を使い、一つずつコマンドを実行していきます。

### ステップ 1: プロジェクトフォルダへ移動
```cmd  
cd /d "C:\dev\A.R.G.U.S.-v2"  
```

### ステップ 2: Python仮想環境の作成
```cmd  
python -m venv venv 
```
この操作は、PCごとに最初の1回だけでOKです。

### ステップ 3: 仮想環境の有効化 (Activate)
```cmd  
venv\Scripts\activate  
```
成功すると、プロンプトの先頭に `(venv)` と表示されます。

### ステップ 4: 必要なライブラリのインストール
```cmd  
pip install mitmproxy
pip install flask
pip install sqlalchemy
pip install flask-socketio 
```
これで、すべてのセットアップ作業は完了です。

---

## 使い方

### 1. A.R.G.U.S.-v2 の起動

手動で起動するか、バッチファイルで起動するかを選べます。

**A) 手動での起動 (2つのターミナルを使用)**
1.  コマンドプロンプトを開き、プロジェクトフォルダに移動 (`cd /d "..."`) し、仮想環境を有効化 (`venv\Scripts\activate`) します。
2.  そのターミナルでWeb管理ダッシュボードを起動します。
    ```cmd  
    python main.py  
    ```
3.  **もう一つ新しいコマンドプロンプトを開き**、同様にプロジェクトフォルダへの移動と仮想環境の有効化を行います。
4.  その2つ目のターミナルでプロキシ本体を起動します。
    ```cmd  
    mitmweb -s proxy_addon.py --web-port 8081 --listen-port 8080 --set block_global=false  
    ```

**B) バッチファイルでの起動 (`final-start.bat`)**
`final-start.bat`スクリプトは、上記の手動起動プロセスを自動化します。
1.  コマンドプロンプトを開き、プロジェクトフォルダに移動して仮想環境を有効化します (`venv\Scripts\activate`)。
2.  その状態で以下のコマンドを入力して実行します。
    ```cmd  
    .\final-start.bat 
    ```

### 2. プロキシの設定

お使いのブラウザ、またはWindows自体のプロキシ設定を以下のように構成します。

-   **プロキシサーバーのアドレス**: `127.0.0.1`
-   **ポート**: `8080`

### 3. HTTPS通信のための証明書インストール (重要)

HTTPSサイトを正しくブロック・監視するには、`mitmproxy`の証明書をPCに信頼させる必要があります。この作業は**最初の1回だけ**必要です。

1.  A.R.G.U.S.を起動し、プロキシ設定を有効にした状態で、ブラウザで `http://mitm.it` にアクセスします。
2.  Windowsアイコンをクリックし、証明書ファイル (`mitmproxy-ca-cert.cer`) をダウンロードします。
3.  ダウンロードしたファイルをダブルクリックして開きます。
4.  「証明書のインストール...」→「現在のユーザー」→「証明書をすべて次のストアに配置する」→「参照...」と進み、**「信頼されたルート証明機関」**を選択してインストールを完了します。

### 4. ブロックリストの編集

ブロックしたいドメインを `config/blocked_domains.txt` ファイルに追記します。ファイルの変更はA.R.G.U.S.を再起動することなく即座に反映されます。

### 5. A.R.G.U.S. の終了

起動時に開いた2つのコマンドプロンプトウィンドウを、それぞれ右上の「×」ボタンで閉じるか、`Ctrl + C` を押してプロセスを終了してください。

---

## トラブルシューティング

-   **`mitm.it` にアクセスできない**:
    -   A.R.G.U.S. (特に`mitmweb`のプロセス) が正しく起動しているか確認してください。
    -   ブラウザまたはOSのプロキシ設定が `127.0.0.1:8080` に正しく設定されているか確認してください。

-   **証明書をインストールしてもHTTPSサイトで警告が出る**:
    -   証明書を**「信頼されたルート証明機関」**ストアに正しくインストールしたか確認してください。
    -   一部のアプリケーションやブラウザ（Firefoxなど）は独自の証明書ストアを持っている場合があります。その場合は、各アプリケーションごとの手順に従って証明書をインポートする必要があります。
    -   一度ブラウザを完全に再起動してみてください。

-   **コマンド`py`や`pip`が見つからないと言われる**:
    -   Pythonのインストール時に「Add Python to PATH」オプションを有効にしなかった可能性があります。Pythonを再インストールするか、環境変数を手動で設定してください。
    -   仮想環境を有効化 (`venv\Scripts\activate`) し忘れていないか確認してください。

---

## 貢献 (Contributing)

バグ報告、機能追加の提案、プルリクエストを歓迎します。貢献したい場合は、Issueを作成するか、このリポジトリをフォークして変更を加え、プルリクエストを送ってください。

---

## ライセンス (License)

このプロジェクトは **MITライセンス** の下で公開されています。ライセンスの全文については、リポジトリに含まれる`LICENSE`ファイルを参照してください。

---

## 謝辞 (Acknowledgements)

このプロジェクトは、以下の素晴らしいオープンソースライブラリの力によって実現しました。

-   [**Mitmproxy**](https://mitmproxy.org/): 高機能なインタラクティブTLS対応プロキシ。
-   [**Flask**](https://flask.palletsprojects.com/): Python製マイクロWebフレームワーク。
-   [**SQLAlchemy**](https://www.sqlalchemy.org/): Python SQLツールキットおよびオブジェクトリレーショナルマッパー(ORM)。
